<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QR Generator</title>
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-900 text-white flex flex-col items-center justify-center min-h-screen">
  <div class="p-8 bg-gray-800 shadow-xl flex flex-col items-center w-96">
    <h1 class="text-3xl font-bold mb-4">QR Generator</h1>

    <input id="text" type="text" placeholder="Testo o URL"
      class="p-3 w-full text-black mb-3 outline-none rounded-none" />

    <input id="color" type="color" value="#000000" class="mb-3 w-full" title="Colore QR" />
    <input id="bgcolor" type="color" value="#ffffff" class="mb-3 w-full" title="Sfondo QR" />
    <input id="iconUrl" type="text" placeholder="URL icona al centro (opzionale)"
      class="p-3 w-full text-black mb-3 outline-none rounded-none" />

    <div class="g-recaptcha mb-3" data-sitekey="6LeSn_QrAAAAAN8MyhZIdE93WqG6BS70jwzXawVe" data-callback="enableButton"></div>

    <button id="generateBtn" onclick="generateQR()" class="bg-blue-600 px-4 py-2 w-full font-semibold disabled:opacity-50" disabled>Genera</button>

    <div id="qrcode" class="mt-6"></div>

    <a id="downloadLink" href="#" download="qrcode.png"
       class="hidden bg-green-600 hover:bg-green-700 mt-4 px-4 py-2 font-semibold">Download QR</a>
  </div>

  <script>
    let qr;

    function enableButton() {
      document.getElementById("generateBtn").disabled = false;
    }

    function generateQR() {
      const text = document.getElementById("text").value.trim();
      const color = document.getElementById("color").value;
      const bgColor = document.getElementById("bgcolor").value;
      const iconUrl = document.getElementById("iconUrl").value.trim();
      const qrDiv = document.getElementById("qrcode");
      qrDiv.innerHTML = "";

      if (!text) return;

      qr = new QRCode(qrDiv, {
        text,
        width: 200,
        height: 200,
        colorDark: color,
        colorLight: bgColor,
        correctLevel: QRCode.CorrectLevel.H
      });

      setTimeout(() => {
        const canvas = qrDiv.querySelector("canvas");
        if (iconUrl) {
          const ctx = canvas.getContext("2d");
          const icon = new Image();
          icon.crossOrigin = "anonymous";
          icon.src = iconUrl;
          icon.onload = () => {
            const size = canvas.width * 0.25;
            ctx.drawImage(icon, (canvas.width - size) / 2, (canvas.height - size) / 2, size, size);
            showDownload(canvas);
          };
        } else {
          showDownload(canvas);
        }
      }, 300);
    }

    function showDownload(canvas) {
      const link = document.getElementById("downloadLink");
      link.href = canvas.toDataURL("image/png");
      link.classList.remove("hidden");
    }
  </script>
</body>
</html>
